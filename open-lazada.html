<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ร้าน Shopee ของฉัน</title>
  <style>
    body {
      font-family: "Noto Sans Thai", sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      background: linear-gradient(135deg, #fff5f2, #ffffff);
      text-align: center;
      padding: 20px;
    }
    img {
      width: 90px;
      margin-bottom: 16px;
    }
    h1 {
      color: #ee4d2d;
      font-size: 1.5rem;
      margin: 10px 0;
    }
    p {
      color: #444;
      font-size: 1rem;
      margin: 0 0 20px;
      line-height: 1.5;
    }
    button {
      background: linear-gradient(90deg, #ee4d2d, #d73211);
      color: white;
      border: none;
      border-radius: 10px;
      padding: 14px 20px;
      font-size: 1rem;
      cursor: pointer;
      transition: transform 0.2s;
    }
    button:hover { transform: scale(1.05); }
    small {
      display:block;
      margin-top:16px;
      color:#777;
    }
  </style>
</head>
<body>
  <img src="https://cdn-icons-png.flaticon.com/512/3670/3670322.png" alt="Shopee Logo">
  <h1>ร้าน Shopee ของฉัน</h1>
  <p id="message">กำลังตรวจสอบการเชื่อมต่อ...</p>
  <button id="openButton" style="display:none;">เปิดในแอป Shopee</button>
  <small>ถ้าไม่มีแอป ระบบจะพาคุณไปยังหน้าร้านโดยอัตโนมัติ</small>

  <script>
    const shopUrl = "https://s.lazada.co.th/s.ZaRsJP?cc";
    const message = document.getElementById("message");
    const button = document.getElementById("openButton");

    // ตรวจว่าเปิดจากแอป Facebook หรือ Instagram หรือไม่
    const ua = navigator.userAgent;
    const isFacebook = ua.includes("FBAN") || ua.includes("FBAV") || ua.includes("Instagram");

    if (isFacebook) {
      // ถ้าเปิดใน Facebook → แสดงปุ่มให้เปิดภายนอก
      message.textContent = "⚠️ คุณเปิดลิงก์นี้จากแอป Facebook";
      button.textContent = "เปิดในเบราว์เซอร์ภายนอก (Chrome / Safari)";
      button.style.display = "inline-block";

      button.addEventListener("click", () => {
        // ใช้วิธีเปิดแท็บใหม่ เพื่อออกจาก In-App Browser
        window.open(shopUrl, "_blank");
      });

    } else {
      // ถ้าไม่ใช่ Facebook → พยายามเปิดแอป Shopee
      message.textContent = "กำลังเปิดแอป Shopee...";
      const timeout = 1500;
      let opened = false;

      const handleVisibility = () => {
        if (document.hidden) opened = true;
      };
      document.addEventListener("visibilitychange", handleVisibility);

      // Android ใช้ intent://
      if (/Android/i.test(ua)) {
        const intentUrl = "intent://open#Intent;scheme=shopee;package=com.shopee.th;end";
        window.location = intentUrl;
      } else {
        // iOS ใช้ iframe trick
        const iframe = document.createElement("iframe");
        iframe.style.display = "none";
        iframe.src = "shopee://";
        document.body.appendChild(iframe);
        setTimeout(() => {
          try { document.body.removeChild(iframe); } catch(e){}
        }, 2000);
      }

      // ถ้าไม่มีแอป ให้ไปเว็บร้าน
      setTimeout(() => {
        document.removeEventListener("visibilitychange", handleVisibility);
        if (!opened) {
          message.textContent = "ไม่พบแอป Shopee — กำลังไปยังเว็บร้านของคุณ...";
          window.location.href = shopUrl;
        } else {
          message.textContent = "เปิดแอป Shopee สำเร็จ ✓";
        }
      }, timeout);
    }
  </script>
</body>
</html>
