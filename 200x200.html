<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Image Editor – Resize, Move, Text, Sticker</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f3f3f3; }
    .toolbar { display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap; }
    .panel { background: white; padding: 10px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    canvas { border: 1px solid #ccc; background: white; cursor: move; }
    input[type=file] { padding: 5px; }
    button { padding: 8px 12px; border: 0; background: #2563eb; color: white; border-radius: 6px; cursor: pointer; }
    button.red { background:#dc2626 }
  </style>
</head>
<body>
  <h2>โปรแกรมแต่งรูป – ปรับขนาด, เลื่อนตำแหน่ง, ใส่สติ๊กเกอร์, พิมพ์ข้อความ</h2>

  <div class="panel toolbar">
    <input id="uploadImage" type="file" accept="image/*" />
    <button id="addTextBtn">เพิ่มข้อความ</button>
    <button id="addStickerBtn">เพิ่มภาพตัดปะ</button>
    <button id="downloadBtn">ดาวน์โหลดภาพ</button>
  </div>

  <div class="panel" style="padding:15px;">
    <canvas id="editor" width="600" height="600"></canvas>
  </div>

  <script>
    const canvas = document.getElementById("editor");
    const ctx = canvas.getContext("2d");

    let objects = []; // เก็บเลเยอร์ทั้งหมด (ภาพ, ข้อความ, สติ๊กเกอร์)
    let selected = null;
    let offsetX = 0, offsetY = 0;

    function drawAll() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      for (let obj of objects) {
        if (obj.type === "image" || obj.type === "sticker") {
          ctx.drawImage(obj.img, obj.x, obj.y, obj.w, obj.h);
        } else if (obj.type === "text") {
          ctx.font = obj.size + "px sans-serif";
          ctx.fillStyle = obj.color;
          ctx.fillText(obj.text, obj.x, obj.y);
        }
      }
    }

    function loadImage(file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        const img = new Image();
        img.onload = () => {
          const scale = 400 / Math.max(img.width, img.height);
          const w = img.width * scale;
          const h = img.height * scale;
          objects.push({type:"image", img, x:100, y:100, w, h});
          drawAll();
        }
        img.src = e.target.result;
      }
      reader.readAsDataURL(file);
    }

    document.getElementById("uploadImage").addEventListener("change", e => {
      if (e.target.files[0]) loadImage(e.target.files[0]);
    });

    document.getElementById("addTextBtn").addEventListener("click", () => {
      const text = prompt("พิมพ์ข้อความ:");
      if (!text) return;
      objects.push({type:"text", text, x:150, y:150, size:40, color:"#000"});
      drawAll();
    });

    document.getElementById("addStickerBtn").addEventListener("click", () => {
      const url = prompt("วางลิงก์ภาพสติ๊กเกอร์ (PNG):");
      if (!url) return;
      const img = new Image();
      img.onload = () => {
        const w = img.width/2;
        const h = img.height/2;
        objects.push({type:"sticker", img, x:120, y:120, w, h});
        drawAll();
      }
      img.crossOrigin = "anonymous";
