<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Image Editor + 200x200 Preview</title>
<style>
    body {
        font-family: sans-serif;
        display: flex;
        gap: 20px;
    }
    #editorArea {
        border: 1px solid #ccc;
        position: relative;
    }
    canvas {
        background: #f0f0f0;
    }
    #previewBox {
        border: 2px solid #000;
        width: 200px;
        height: 200px;
        overflow: hidden;
    }
    #previewCanvas {
        width: 200px;
        height: 200px;
    }
</style>
</head>
<body>

<div>
    <h3>ตัวแก้ไขรูป</h3>

    <input type="file" id="uploadImage" accept="image/*"><br><br>

    <button onclick="addText()">เพิ่มข้อความ</button>
    <button onclick="downloadImage()">ดาวน์โหลด PNG</button>

    <br><br>

    <div id="editorArea">
        <canvas id="mainCanvas" width="500" height="500"></canvas>
    </div>
</div>

<div>
    <h3>ตัวอย่าง 200×200</h3>
    <div id="previewBox">
        <canvas id="previewCanvas" width="200" height="200"></canvas>
    </div>
</div>

<script>
let canvas = document.getElementById("mainCanvas");
let ctx = canvas.getContext("2d");

let previewCanvas = document.getElementById("previewCanvas");
let pctx = previewCanvas.getContext("2d");

let currentImage = null;

// อัปโหลดภาพ
document.getElementById("uploadImage").addEventListener("change", function (e) {
    let file = e.target.files[0];
    if (!file) return;

    let reader = new FileReader();
    reader.onload = function (evt) {
        let img = new Image();
        img.onload = function () {
            currentImage = img;
            draw();
        };
        img.src = evt.target.result;
    };
    reader.readAsDataURL(file);
});

// วาดภาพ + พรีวิว
function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    if (currentImage) {
        ctx.drawImage(currentImage, 0, 0, canvas.width, canvas.height);
    }
    updatePreview();
}

// อัปเดตพรีวิว 200×200
function updatePreview() {
    pctx.clearRect(0, 0, 200, 200);
    pctx.drawImage(canvas, 0, 0, 200, 200);
}

// เพิ่มข้อความลงรูป
function addText() {
    ctx.font = "40px Arial";
    ctx.fillStyle = "red";
    ctx.fillText("ข้อความ", 50, 50);
    updatePreview();
}

// ดาวน์โหลด PNG
function downloadImage() {
    let link = document.createElement("a");
    link.download = "edited.png";
    link.href = canvas.toDataURL();
    link.click();
}
</script>

</body>
</html>
